# Magento2.0模型
---

## 建立数据表

`app/code/Coolryan/InstallationExample/Setup/InstallSchema.php` 代码如下:

```
<?php
 
namespace Coolryan\InstallationExample\Setup;
 
use Magento\Framework\Setup\InstallSchemaInterface;
use Magento\Framework\Setup\ModuleContextInterface;
use Magento\Framework\Setup\SchemaSetupInterface;
use Magento\Framework\DB\Adapter\AdapterInterface;
use Magento\Framework\DB\Ddl\Table;
 
class InstallSchema implements InstallSchemaInterface {
 
    public function install( SchemaSetupInterface $setup, ModuleContextInterface $context ) {
        $installer = $setup;
 
        $installer->startSetup();
 
        /**
         * Create table 'posts'
         */
        $table = $installer->getConnection()->newTable(
            $installer->getTable( 'blog_posts' )
        )->addColumn(
            'post_id',
            Table::TYPE_SMALLINT,
            null,
            [ 'identity' => true, 'nullable' => false, 'primary' => true ],
            'Post ID'
        )->addColumn(
            'title',
            Table::TYPE_TEXT,
            255,
            [ 'nullable' => false ],
            'Post Title'
        )->addColumn(
            'identifier',
            Table::TYPE_TEXT,
            255,
            [ 'nullable' => false ],
            'Post String Identifier'
        )->addColumn(
            'content',
            Table::TYPE_TEXT,
            '2M',
            [ ],
            'Post Content'
        )->addColumn(
            'creation_time',
            Table::TYPE_TIMESTAMP,
            null,
            [ 'nullable' => false, 'default' => Table::TIMESTAMP_INIT ],
            'Post Creation Time'
        )->addColumn(
            'update_time',
            Table::TYPE_TIMESTAMP,
            null,
            [ 'nullable' => false, 'default' => Table::TIMESTAMP_INIT_UPDATE ],
            'Post Update Time'
        )->addColumn(
            'is_active',
            Table::TYPE_SMALLINT,
            null,
            [ 'nullable' => false, 'default' => '1' ],
            'Is Post Active'
        )->addIndex(
            $setup->getIdxName(
                $installer->getTable( 'blog_posts' ),
                [ 'title', 'identifier', 'content' ],
                AdapterInterface::INDEX_TYPE_FULLTEXT
            ),
            [ 'title', 'identifier', 'content' ],
            [ 'type' => AdapterInterface::INDEX_TYPE_FULLTEXT ]
        )->setComment(
            'Blog Post Table'
        );
 
        $installer->getConnection()->createTable( $table );
 
        $installer->endSetup();
    }
}
```

`注意：如果在此之前，安装过此模块，需在数据库的 setup_module 表里面删掉记录 `

在命令行里面运行  `php bin/magento setup:upgrade`


## 建立模型
---

1. 在 `Model` 文件下建立 Blog.php 模型文件 ，代码为:

```
<?php

namespace Jerry\Member\Model;
use \Magento\Framework\Model\AbstractModel;

class Blog extends AbstractModel {
    protected function _construct() {
        $this->_init('Jerry\Member\Model\ResourceModel\Blog');
    }
}
```

2. 在 `Model/ResourceModel` 建立资源文件 Blog.php ,代码为:

```
<?php
namespace Jerry\Member\Model\ResourceModel;

use \Magento\Framework\Model\ResourceModel\Db\AbstractDb;

class Blog extends AbstractDb {
    protected function _construct() {
        // TODO: Implement _construct() method.
        $this->_init('blog_posts', 'post_id');
    }
}
``` 

3. 在 `Model/ResourceModel/Blog` 下建立资源 collection文件 collection.php,代码为:

```
<?php

namespace Jerry\Member\Model\ResourceModel\Blog;
use \Magento\Framework\Model\ResourceModel\Db\Collection\AbstractCollection;

class Collection extends AbstractCollection {
    protected function _construct() {
        parent::_construct(); // TODO: Change the autogenerated stub
        $this->_init('Jerry\Member\Model\Blog', 'Jerry\Member\Model\ResourceModel\Blog');
    }
}
```

### 使用模型
---

在 `Block` 或者 `Controller` 里面 `use Jerry\Member\Model\BlogFactory`,然后在构造函数里面直接使用依赖注入的方式来注册这个factory,例如:


```
    public function __construct(BlogFactory $blogFactory){
        $this->_blogFactory = $blogFactory;
    }
```
> 注意，IDE里面可能会提示错误，此时需要先删除项目目录	`var/generation` 里面的数据，然后magento会自动生成这个factory

1. ***查看*** 

```
$blogModel = $this->_blogFactory->create();
$item = $blogModel->load(1);
$data = $item->getData();
```

2. ***添加***

```
$blogModel = $this->_blogFactory->create();
$data = ['title' => 'add title', 'content' => 'add content'];
$blogModel->addData($data);
$blogModel->save();
```

3. ***修改***

```
$blogModel = $this->_blogFactory->create();
$item = $blogModel->load(1);
$data = ['title' => 'add title', 'content' => 'add content'];
$blogModel->addData($data);
$blogModel->save();
```

4. ***删除***

```
$blogModel = $this->_blogFactory->create();
$blogModel->setId(1);
$blogModel->delete();
```








